option_settings:
  aws:elasticbeanstalk:container:python:
    WSGIPath: FoodApp_by_Sage.wsgi:application
  aws:elasticbeanstalk:environment:proxy:
    ProxyServer: nginx

files:
  "/etc/nginx/conf.d/custom_nginx.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      location /static/ {
          alias /var/app/current/staticfiles/;
          expires 30d;
          add_header Cache-Control "public";
          
          location ~ \.css$ {
              default_type text/css;
              add_header Content-Type text/css;
          }
          
          location ~ \.(jpg|jpeg|png|gif|ico|webp)$ {
              expires 30d;
          }
      }

container_commands:
  01_remove_staticfiles:
    command: "rm -rf staticfiles/*"
    ignoreErrors: true
  02_create_staticfiles_dir:
    command: "mkdir -p staticfiles"
  03_grant_permissions:
    command: "chmod 755 staticfiles"
  04_collectstatic:
    command: |
      source $PYTHONPATH/activate
      python manage.py collectstatic --noinput
  05_grant_collected_permissions:
    command: "chmod -R 755 staticfiles/"
  06_verify_files:
    command: "ls -la staticfiles/"