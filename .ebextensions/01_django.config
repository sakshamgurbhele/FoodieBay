option_settings:
  aws:elasticbeanstalk:container:python:
    WSGIPath: FoodApp_by_Sage.wsgi:application
  aws:elasticbeanstalk:environment:proxy:
    ProxyServer: nginx

files:
  "/etc/nginx/conf.d/custom_nginx.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      location / {
          proxy_pass http://127.0.0.1:8000;
          proxy_set_header Host $host;
          proxy_set_header X-Real-IP $remote_addr;
      }
      
      location /static/ {
          alias /var/app/current/staticfiles/;
          autoindex off;
          expires 1d;
          add_header Cache-Control "public, no-transform";
      }

container_commands:
  01_makedirs:
    command: |
      mkdir -p staticfiles
      chmod 755 staticfiles
  02_collectstatic:
    command: |
      source $PYTHONPATH/activate
      python manage.py collectstatic --noinput --clear
  03_permissions:
    command: |
      chmod 755 staticfiles
      chmod -R 755 staticfiles/*
  04_list_files:
    command: |
      echo "Listing static files:"
      ls -R staticfiles/