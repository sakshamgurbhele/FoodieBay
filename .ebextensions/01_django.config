option_settings:
  aws:elasticbeanstalk:container:python:
    WSGIPath: FoodApp_by_Sage.wsgi:application
  aws:elasticbeanstalk:environment:proxy:
    ProxyServer: nginx

files:
  "/etc/nginx/conf.d/custom_nginx.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      server {
          client_max_body_size 20M;
          
          location /static/ {
              root /var/app/current;
              access_log off;
              expires 30d;
              
              location ~* \.(css)$ {
                  add_header Content-Type text/css;
              }
              
              location ~* \.(js)$ {
                  add_header Content-Type application/javascript;
              }
              
              location ~* \.(jpg|jpeg|png|gif|ico|webp)$ {
                  add_header Cache-Control "public, no-transform";
              }
          }
          
          location /media/ {
              root /var/app/current;
              access_log off;
              expires 30d;
          }
      }

container_commands:
  01_remove_static:
    command: "rm -rf staticfiles"
    ignoreErrors: true
  02_collectstatic:
    command: |
      source $PYTHONPATH/activate
      python manage.py collectstatic --noinput --clear
  03_static_permissions:
    command: |
      chmod -R 755 staticfiles/