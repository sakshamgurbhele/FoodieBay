<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ product.item_name }} - FoodieBay</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
 
</head>
<body>

{% include 'navbar.html' %}

    <!-- Food Item Detail Section -->
    <div class="container my-5">
        <div class="row">
            <!-- Food Image -->
            <div class="col-md-6">
                <img src="{{ product.image.url }}" class="img-fluid rounded shadow" alt="{{ product.item_name }}">
            </div>

            <!-- Food Details -->
            <div class="col-md-6">
                <h1 class="display-4 font-weight-bold">{{ product.item_name }}</h1>
                {% if product.non_veg %}
                    <span class="badge bg-danger">Non-Veg</span>
                {% else %}
                    <span class="badge bg-success">Veg</span>
                {% endif %}
                <p class="lead mt-3 text-muted">{{ product.description }}</p>
                <h3 class="text-primary font-weight-bold">€ {{ product.price }}</h3>
                
                <div class="ms-1 mt-4" style="width: 80px;">
                        <select class="form-select" id="qty-cart">
                          <option selected>Qty</option>
                          <option value="1">1</option>
                          <option value="2">2</option>
                          <option value="3">3</option>
                          <option value="4">4</option>
                          <option value="5">5</option>
                        </select>
                    </div>

                <!-- Buttons -->
                <div class="mt-4">
                    <button class="btn btn-primary btn-lg rounded-pill shadow-sm me-2" type="button" data-product-id="{{ product.id }}" id="buy">Buy Now</button>
                    <button class="btn btn-outline-secondary btn-lg rounded-pill shadow-sm" type="button" data-product-id="{{ product.id }}" id="add-cart">
                        <i class="bi bi-cart"></i> Add to Cart
                    </button>
                </div>
            </div>
        </div>

        <!-- Back to Home Button -->
        <div class="mt-5 text-center">
            <a href="/" class="btn btn-link text-primary"><i class="bi bi-arrow-left"></i> Back to Home</a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>

// Add to cart Functionality
$(document).on('click', '#add-cart', function(e) {
    e.preventDefault();
    console.log("Button clicked!"); // Debugging

    const productId = $(this).data('product-id');
    const productQty = $('#qty-cart option:selected').text(); // Get selected quantity
    
    console.log("Product ID:", productId); // Debugging

    $.ajax({
        type: 'POST',
        url: '{% url "cart_add" %}',  // Add item to the cart
        data: {
            product_id: productId,
            product_qty: productQty,
            csrfmiddlewaretoken: '{{ csrf_token }}',
            action: 'post'
        },
        success: function(json) {
            // Update the cart quantity display
            document.getElementById('cart_quantity').textContent = json.qty;
            alert('Item added to cart successfully!');
        },
        error: function(xhr, errmsg, err) {
            console.error("Error:", xhr.status, errmsg);
        }
    });
});

// Update Cart Quantity Functionality
$(document).on('change', '.cart-quantity-input', function(e) {
    e.preventDefault();
    const productId = $(this).data('product-id');  // Get product ID from the data attribute
    const newQty = $(this).val();  // Get the new quantity value
    
    if (newQty < 1) {
        alert("Quantity must be at least 1.");
        $(this).val(1);  // Reset the value to 1
        return;
    }

    $.ajax({
        type: 'POST',
        url: '{% url "cart_update" %}',  // Update cart item quantity
        data: {
            product_id: productId,
            product_qty: newQty,
            csrfmiddlewaretoken: '{{ csrf_token }}',
            action: 'update'
        },
        success: function(json) {
            // Update the cart total and quantity display
            document.getElementById('cart_quantity').textContent = json.qty;
            document.getElementById('cart_total').textContent = '€' + json.total;
            alert(json.message);  // Optional: Show a success message
        },
        error: function(xhr, errmsg, err) {
            console.error("Error:", xhr.status, errmsg);
        }
    });
});

// Buy Button Function
$(document).on('click', '#buy', function(e) {
    e.preventDefault();
    console.log("Button clicked!"); // Debugging

    const productId = $(this).data('product-id');
    
    
    console.log("Product ID:", productId); // Debugging

    $.ajax({
        type: 'POST',
        url: '{% url "cart_add" %}',
        data: {
            product_id: productId,
            product_qty: $('#qty-cart option:selected').text(), 
            csrfmiddlewaretoken: '{{ csrf_token }}',
            action: 'post'
        },
        success: function(json) {
            document.getElementById('cart_quantity').textContent = json.qty
            window.location.href = '/cart';
        },
        error: function(xhr, errmsg, err) {
            console.error("Error:", xhr.status, errmsg);
        }
    });
});
</script>

</body>
</html>
